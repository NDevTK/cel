# Format: lab_config.proto:Assets
# 
# Configuration for the Chrome enterprise lab in textpb. See go/textpb before
# editing this file.

# Service account to be used on test runner VMs.
service_account: {
	id: "runner"
	display_name: "Laboratory Test Runner"
}

# The |chrome-auth-lab| network has special firewall settings that restrict
# whether different machines in the lab can talk to each other using |tags|.
network: {
	name: "chrome-auth-lab"
	description: "Chrome Auth Lab network"
	ipv4_address_range: "10.1.0.0/16"

	firewall_rule: {
		name: "firewall-from-commons-to-a"
		description: "Firewall allowing traffic from 'commons' to 'group-a'"
		allowed: {
			protocol: "*"
			ports: "1-65535"
		}
		source_tag: "commons"
		target_tag: "group-a"
	}

	firewall_rule: {
		name: "firewall-from-commons-to-commons"
		description: "Firewall allowing traffic from 'commons' to 'group-a'"
		allowed: {
			protocol: "*"
			ports: "1-65535"
		}
		source_tag: "commons"
		target_tag: "commons"
	}

	firewall_rule: {
		name: "firewall-from-commons-to-b"
		description: "Firewall allowing traffic from 'commons' to 'group-a'"
		allowed: {
			protocol: "*"
			ports: "1-65535"
		}
		source_tag: "commons"
		target_tag: "group-b"
	}

	firewall_rule: {
		name: "firewall-from-a-to-commons"
		description: "Firewall allowing traffic from 'group-a' to 'commons'"
		allowed: {
			protocol: "*"
			ports: "1-65535"
		}
		source_tag: "group-a"
		target_tag: "commons"
	}

	firewall_rule: {
		name: "firewall-from-b-to-commons"
		description: "Firewall allowing traffic from 'group-b' to 'commons'"
		allowed: {
			protocol: "*"
			ports: "1-65535"
		}
		source_tag: "group-b"
		target_tag: "commons"
	}
}

# Windows 2016 image. We are going to use a Windows Server 2016 image with
# desktop components.
source_image: {
	name: "win-2016"
	latest: {
		family: "windows-2016"
		project: "windows-cloud"
	}
}

# These are options that are applied by default to instances. Each instance
# definition can be freely overridden as necessary in individual instance
# definitions.
instance_type: {
	name: "windows"
	create_options: {
		zone: "us-east1-b"

		machine_type: "n1-standard-1"

		interface: {
			network: "chrome-auth-lab"
		}

		# Note that if you change |preemptible| in the default options, it cannot be
		# overridden by an instance specific setting.
		preemptible: false

		# The default service account for VMs. The labsvc account allows ready-only
		# access to Google Cloud Storage and write-only access to logs. When
		# changing a service account:
		#   1. Add a service account via "IAM & Admin" -> Service Accounts -> Add.
		#   2. Add the necessary roles to the service account via "IAM & Admin" ->
		#         IAM -> Add
		service_account: {
			id: "runner"

			scope: "devstorage.read_only"
			scope: "logging.write"
		}

		cryptokey: {
			keyring: "lab"
			cryptokey: "instance-key"
		}
	}
}

# win-ad: Active Directory Server
instance: {
	name: "ad"
	role: "primary-dc"
	type: "windows"
	description: "Windows Active Directory server"

	create_options: {
		image: "win-2016"
	}
}

# win-iis: IIS Server
instance: {
	name: "iis"
	role: "iis"
	type: "windows"
	description: "Windows IIS Server"

	create_options: {
		image: "win-2016"
	}
}

# win-client: Client
instance: {
	name: "win-c"
	role: "client"
	type: "windows"
	description: "Windows Client"

	create_options: {
		image: "win-2016"
	}
}

# The primary Windows domain is lab.chrome. It used to be ad.chrome, but it
# turns out to be confusing for Googlers.
windows_domain: {
	name: "lab.chrome"

	# LAB\labrat is the primary account under which we run our tests. Not
	# priviledged is not not granted local admin privileges.
	account: {
		name: "labrat"
		full_name: "Laborc Rattman"
		role: MINION
	}

	# LAB\labman is an administrator level account used for joining workstations
	# to domains. It is also a domain administrator account.
	account: {
		name: "labman"
		full_name: "Labania Mandie"
		role: ADMIN
	}

	# Safemode lab recovery administrator account. Not really used, but we need
	# to specify one during AD domain creation.
	account: {
		name: "labrec"
		full_name: "Labaan Recaredo"
		role: SAFE_MODE_ADMIN
	}
}

# vim: set ft=conf tw=80 ts=4 sw=4:
